---
- hosts: all
  gather_facts: no
  become: true

  # Python 2 is missing by default in ubuntu 16.
  # https://stackoverflow.com/questions/32429259/ansible-fails-with-bin-sh-1-usr-bin-python-not-found
  tasks:

    - name: install python 2
      raw: test -e /usr/bin/python || (sudo apt -y update && sudo apt install -y python-minimal)

    - name: Install aptitude module
      become: true
      apt: name=aptitude state=present

    - name: Update and upgrade apt packages
      become: true
      apt: upgrade=no update_cache=yes
      register: upgrade_status

    - name: Distribution upgrade
      become: true
      apt: upgrade=dist

    -

